<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, September 20, 2016, 9:05 AM -->
<!-- MuClient version 5.01 -->

<!-- Plugin "HadarRepop" generated by Plugin Wizard -->

<muclient>
<plugin
   name="HadarGoldTracker"
   author="Hadar"
   id="ff007fc4c4258417ba53eebf"
   language="Lua"
   purpose="Track all the gold"
   save_state="y"
   date_written="2017-01-20 09:04:48"
   requires="4.00"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->
<triggers>
  <trigger
   enabled="y"
   match="^.* crumbles into ([+-]?[0-9,]+) gold pieces\.$"
   regexp="y"
   send_to="12"
   script="AddGoldCrumble"
   sequence="100"
  >
  </trigger>
  <trigger
   enabled="y"
   match="^You get ([+-]?[0-9,]+) gold coins from.*corpse of .*\.$"
   regexp="y"
   send_to="12"
   script="AddMobGold"
   sequence="100"
  >
  </trigger>
  <trigger
   enabled="y"
   match="^You are taxed ([+-]?[0-9,]+) gold coins by your clan\.$"
   regexp="y"
   send_to="12"
   script="TaxedGold"
   sequence="100"
  >
  </trigger>
    <trigger
   enabled="y"
   match="^.* gives you ([+-]?[0-9,]+) gold coins.*"
   regexp="y"
   send_to="12"
   script="AddGiveGold"
   sequence="100"
  >
  </trigger>
  <trigger
   enabled="y"
   match="^You give ([+-]?[0-9,]+) gold to .*\.$"
   regexp="y"
   send_to="12"
   script="LoseGoldGive"
   sequence="100"
  >
  </trigger>
  <trigger
   enabled="y"
   match="^You buy .* from .* for ([+-]?[0-9,]+) gold\."
   regexp="y"
   send_to="12"
   script="LoseGoldBuy"
   sequence="100"
  >
  </trigger>
  <trigger
   enabled="y"
   match="^You sell .* to .* for ([+-]?[0-9,]+) gold."
   regexp="y"
   send_to="12"
   script="GainGoldSell"
   sequence="100"
  >
  </trigger>

</triggers>

<aliases>
  <alias
   match="goldtracked"
   enabled="y"
   send_to="12"
   sequence="50"
   script="GoldTracked"
  >
  </alias>
</aliases>

<script>
<![CDATA[

dofile (GetPluginInfo (GetPluginID (), 20) .. "luapath.lua")

require "checkplugin"
require "serialize"
require "HadarLuaCommon"

function OnPluginInstall()
   print("Track all the gold!")
   
   	if GetVariable ("enabled") == "false" then
		ColourNote ("yellow", "", "Warning: Plugin " .. GetPluginName ().. " is currently disabled.")
		check (EnablePlugin(GetPluginID (), false))
		return
	end -- they didn't enable us last time
  
	OnPluginEnable ()
end

function GoldTracked()
print("Gold Gained all time:"..GoldTrack.alltime)
print("Gold Gained from Crumbles:"..GoldTrack.Crumble)
print("Gold Gained from Mobs:"..GoldTrack.MobGold)
print("Gold Gained from Selling:"..GoldTrack.ABuyGold)
print("Gold Gained from Gives:"..GoldTrack.AGiveGold)
print("")
print("Gold Lost from Gives:"..GoldTrack.LGiveGold)
print("Gold Lost from buying:"..GoldTrack.LBuyGold)
print("")
print("Gold from this Session:"..GoldTrack.Session)
end

function OnPluginEnable ()
	GoldTrack={}
	
	GoldTrack.alltime = 0
	GoldTrack.Crumble = 0
	GoldTrack.MobGold = 0
	GoldTrack.TaxedGold = 0
	GoldTrack.AGiveGold = 0
	GoldTrack.LGiveGold = 0
	GoldTrack.LBuyGold = 0
	GoldTrack.ABuyGold = 0
	GoldTrack.Session = 0
	GoldTrack.LostAll = 0
		
	if GetVariable ("pastfirstinstall") == "true" then
		assert (loadstring (GetVariable ("GoldTrack") or "")) ()
		GoldTrack.Session = 0
	end
end -- endenable

function OnPluginSaveState ()
	SetVariable ("GoldTrack", serialize.save ("GoldTrack"))
	SetVariable ("pastfirstinstall", "true")
end --end save state

function NoMoreComma(num)
	local numstr = string.gsub(num,",","")
	return tonumber(numstr)
end

function AddGoldCrumble(name, line, wildcards)
GoldTrack.alltime = GoldTrack.alltime+NoMoreComma(wildcards[1])
GoldTrack.Crumble = GoldTrack.Crumble+NoMoreComma(wildcards[1])
GoldTrack.Session = GoldTrack.Session+NoMoreComma(wildcards[1])
SaveState()
end

function AddMobGold(name, line, wildcards)
GoldTrack.alltime = GoldTrack.alltime+NoMoreComma(wildcards[1])
GoldTrack.MobGold = GoldTrack.MobGold+NoMoreComma(wildcards[1])
GoldTrack.Session = GoldTrack.Session+NoMoreComma(wildcards[1])
SaveState()
end

function TaxedGold(name, line, wildcards)
GoldTrack.TaxedGold = GoldTrack.TaxedGold+NoMoreComma(wildcards[1])
GoldTrack.LostAll = GoldTrack.LostAll+NoMoreComma(wildcards[1])
SaveState()
end

function AddGiveGold(name, line, wildcards)
GoldTrack.alltime = GoldTrack.alltime+NoMoreComma(wildcards[1])
GoldTrack.AGiveGold = GoldTrack.AGiveGold+NoMoreComma(wildcards[1])
GoldTrack.Session = GoldTrack.AGiveGold+NoMoreComma(wildcards[1])
SaveState()
end

function LoseGoldGive(name, line, wildcards)
GoldTrack.alltime = GoldTrack.alltime+NoMoreComma(wildcards[1])
GoldTrack.LGiveGold = GoldTrack.LGiveGold+NoMoreComma(wildcards[1])
GoldTrack.LostAll = GoldTrack.LostAll+NoMoreComma(wildcards[1])
SaveState()
end

function LoseGoldBuy(name, line, wildcards)
GoldTrack.LBuyGold = GoldTrack.LBuyGold+NoMoreComma(wildcards[1])
GoldTrack.LostAll = GoldTrack.LostAll-NoMoreComma(wildcards[1])
SaveState()
end

function GainGoldSell(name, line, wildcards)
GoldTrack.alltime = GoldTrack.alltime+NoMoreComma(wildcards[1])
GoldTrack.ABuyGold = GoldTrack.ABuyGold+NoMoreComma(wildcards[1])
GoldTrack.Session = GoldTrack.Session+NoMoreComma(wildcards[1])
SaveState()
end

function GoldVal()
      return serialize.save_simple(GoldTrack)
end

]]>
</script>

</muclient>
