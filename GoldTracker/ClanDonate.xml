<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, September 20, 2016, 9:05 AM -->
<!-- MuClient version 5.01 -->

<!-- Plugin "HadarRepop" generated by Plugin Wizard -->

<muclient>
<plugin
   name="HadarClanDonate"
   author="Hadar"
   id="cb28cb738c95bbca17a4f125"
   language="Lua"
   purpose="donate gold on quit"
   save_state="y"
   date_written="2017-01-20 09:04:48"
   requires="4.00"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->
<triggers>

</triggers>

<aliases>
  <alias
   match="^donatepercent ?(show|set)?( [a-z0-9]+)?"
   enabled="y"
   regexp="y"
   send_to="12"
   sequence="50"
   script="donateset"
  >
  </alias>

  <alias
   match="quit"
   enabled="y"
   send_to="12"
   sequence="50"
   script="goldquit"
  >
  </alias>
  <alias match="^(?:had|clando) help$"
	enabled="y"
	sequence="99"
	send_to="12"
	regexp="y"
	keep_evaluating="y"
	>
	<send>
		HadarHelp()
	</send>
	</alias>
  
</aliases>

<script>
<![CDATA[
require "serialize"

function donateset(name, line, wildcards)
	if wildcards[1] == "show" then
		print("Current percent donated: "..donateperc)
	elseif wildcards[1] == "set" then
		if wildcards[2] == "" then
			donateperc = 20
		else
			if tonumber(wildcards[2])<=100 then
				donateperc = tonumber(wildcards[2])
			end
		end
		ColourNote ("Cyan", "", "Current donation set to ","teal","",donateperc)
	end
end

function roundup(num)
	return math.floor(num+0.5)
end

function OnPluginInstall()
   print("Donations!")
   
   donateperc = 20
   
   	if GetVariable ("enabled") == "false" then
		ColourNote ("yellow", "", "Warning: Plugin " .. GetPluginName ().. " is currently disabled.")
		check (EnablePlugin(GetPluginID (), false))
		return
	end -- they didn't enable us last time
  
	OnPluginEnable ()
end

function OnPluginEnable ()
	if GetVariable ("pastfirstinstall") == "true" then
		assert (loadstring (GetVariable ("donateperc") or "")) ()
	end
end -- endenable

function OnPluginSaveState ()
	SetVariable ("donateperc", serialize.save ("donateperc"))
	SetVariable ("pastfirstinstall", "true")
end --end save state


function goldquit()
local res, dagmcp = CallPlugin("ff007fc4c4258417ba53eebf", "GoldVal")
assert(loadstring("LoadInfo = "..dagmcp or "")) ()

if tonumber(LoadInfo.Session)>=1000 then
	doamt = roundup((tonumber(LoadInfo.Session)*tonumber(donateperc))/100)
	Send("Clando "..doamt)
end

Send("quit")
end

function HadarHelp()
	ColourNote("#159FE5","","+----------------------------------","Green","","[","Cyan","","C","Teal","","lan","Cyan",""," D","Teal","","onation","Green","","]","#159FE5","","-----------------------------------+")
	ColourNote("#159FE5","","|"..string.format("%84s"," ").."|")
	ColourNote("#159FE5","","|","#E55B15","",string.format("%-19s"," donatepercent (show) "),"#159FE5","","-","#F1D566","",string.format("%-61s"," Lets you know what current donate percent is at"),"#159FE5","","|")
	ColourNote("#159FE5","","|","#E55B15","",string.format("%-19s"," donatepercent <set> <#> "),"#159FE5","","-","#F1D566","",string.format("%-58s"," Will set the percent (if no number is given set to 20)"),"#159FE5","","|")
	ColourNote("#159FE5","","|"..string.format("%84s"," ").."|")
	ColourNote("#159FE5","","|","#E55B15","",string.format("%-19s"," clando help "),"#159FE5","","-","#F1D566","",string.format("%-64s"," opens up this helpfile"),"#159FE5","","|")
	ColourNote("#159FE5","","|"..string.format("%84s"," ").."|")
	ColourNote("#159FE5","","|","white","",string.format("%84s"," if any issues arise, please contact Hadar via a personal note!"),"#159FE5","","|")
	ColourNote("#159FE5","","+"..string.rep("-",84).."+")
end


]]>
</script>

</muclient>
