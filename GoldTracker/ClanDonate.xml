<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, September 20, 2016, 9:05 AM -->
<!-- MuClient version 5.01 -->

<!-- Plugin "HadarRepop" generated by Plugin Wizard -->

<muclient>
<plugin
   name="HadarClanDonate"
   author="Hadar"
   id="cb28cb738c95bbca17a4f125"
   language="Lua"
   purpose="donate gold on quit"
   save_state="y"
   date_written="2017-01-20 09:04:48"
   requires="4.00"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->
<triggers>

</triggers>

<aliases>
  <alias
   match="^donatepercent ?(show|set)?( [a-z0-9]+)?"
   enabled="y"
   regexp="y"
   send_to="12"
   sequence="50"
   script="donateset"
  >
  </alias>

  <alias
   match="quit"
   enabled="y"
   send_to="12"
   sequence="50"
   script="goldquit"
  >
  </alias>
  
</aliases>

<script>
<![CDATA[
require "serialize"

function donateset(name, line, wildcards)

function OnPluginInstall()
   print("Donations!")
   
   donateperc = 20
   
   	if GetVariable ("enabled") == "false" then
		ColourNote ("yellow", "", "Warning: Plugin " .. GetPluginName ().. " is currently disabled.")
		check (EnablePlugin(GetPluginID (), false))
		return
	end -- they didn't enable us last time
  
	OnPluginEnable ()
end

function OnPluginEnable ()
	if GetVariable ("pastfirstinstall") == "true" then
		assert (loadstring (GetVariable ("donateperc") or "")) ()
	end
end -- endenable

function OnPluginSaveState ()
	SetVariable ("donateperc", serialize.save ("donateperc"))
	SetVariable ("pastfirstinstall", "true")
end --end save state

local donateperc = 1
	if wildcards[1] == "show" then
		print("Current percent donated: "..donateperc)
	elseif wildcards[1] == "set" then
		if wildcards[2] == "nil" then
			donateperc = 20
		else
			if wildcards[2]<=100 then
				donateperc = tonumber(wildcards[2])
			end
		end
	end
end

function goldquit()
local res, dagmcp = CallPlugin("ff007fc4c4258417ba53eebf", "GoldVal")
assert(loadstring("LoadInfo = "..dagmcp or "")) ()

if tonumber(LoadInfo.Session)>=100 then
	math = (tonumber(LoadInfo.Session)*tonumber(donateperc))/100
	Send("Clando "..math)
end

Send("quit")
end


]]>
</script>

</muclient>
