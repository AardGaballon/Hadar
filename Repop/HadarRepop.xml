<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, September 20, 2016, 9:05 AM -->
<!-- MuClient version 5.01 -->

<!-- Plugin "HadarRepop" generated by Plugin Wizard -->

<muclient>
<plugin
   name="HadarRepop"
   author="Hadar"
   id="d04caa4c8c9efbea17eab893"
   language="Lua"
   purpose="just to announce repop"
   save_state="y"
   date_written="2016-09-20 09:04:48"
   requires="4.00"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<script>
<![CDATA[

require "gmcphelper" -- adds the gmcp() function for simplifying data access

function gmcp(what) --pulled from gmcp helper, lets see if fixes older version
	result, value = CallPlugin("3e7dedbe37e44942dd46d264","gmcpval", what)
	if result ~= 0 then
		ColourNote ("orange", "", "Warning: Could not get GMCP value for " .. what)
		return nil
	else
		local luastmt = "ret = " .. value
		assert (loadstring (luastmt or "")) ()
		return ret
	end -- if
end -- gmcp


function OnPluginBroadcast(msg, id, name, text)

local repopchannel = "gt"
local color1 = "@C"
local color2 = "@c"
local timecolor = "@c"
local terminator = "@W"
local zone
local time

  if id == "3e7dedbe37e44942dd46d264" then -- message from the GMCP Handler
    if (text == "comm.repop") then
	  for _,v in pairs(gmcp("comm.repop")) do
		 zone = string.gsub(v, "(%l)(%w*)", function(a,b) return color1..string.upper(a)..color2..string.lower(b) end)
		 time = os.date("%H")..timecolor..":"..terminator..os.date("%M")
	  end
		 SendSpecial(repopchannel.." "..zone.."@W repopped @@ "..time)
    end
  end
end

function OnPluginInstall()
   print("Let us Rule the world with repops!")
end
]]>
</script>

</muclient>
